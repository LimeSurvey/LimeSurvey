!function(q){"object"==typeof exports&&"object"==typeof module?q(require("../../lib/codemirror")):"function"==typeof define&&define.amd?define(["../../lib/codemirror","diff_match_patch"],q):q(CodeMirror)}(function(q){function E(a,b){this.mv=a;this.type=b;this.classes="left"==b?{chunk:"CodeMirror-merge-l-chunk",start:"CodeMirror-merge-l-chunk-start",end:"CodeMirror-merge-l-chunk-end",insert:"CodeMirror-merge-l-inserted",del:"CodeMirror-merge-l-deleted",connect:"CodeMirror-merge-l-connect"}:{chunk:"CodeMirror-merge-r-chunk",
start:"CodeMirror-merge-r-chunk-start",end:"CodeMirror-merge-r-chunk-end",insert:"CodeMirror-merge-r-inserted",del:"CodeMirror-merge-r-deleted",connect:"CodeMirror-merge-r-connect"}}function C(a){a.diffOutOfDate&&(a.diff=S(a.orig.getValue(),a.edit.getValue(),a.mv.options.ignoreWhitespace),a.chunks=T(a.diff),a.diffOutOfDate=!1,q.signal(a.edit,"updateDiff",a.diff))}function D(a,b){if(!a.diffOutOfDate){if(a.needsScrollSync=null,!a.lockScroll)return 1;var c,e,f,g,h,d,k,p=+new Date,m=b?(h=a.edit,a.orig):
(h=a.orig,a.edit);if(h.state.scrollSetBy==a&&(h.state.scrollSetAt||0)+250>p)c=void 0;else{c=h.getScrollInfo();if("align"==a.mv.options.connect)g=c.top;else{e=.5*c.clientHeight;k=c.top+e;f=h.lineAtHeight(k,"local");for(var n=a.chunks,l,r,q,v,t=0;t<n.length;t++){var u=n[t],x=b?u.editFrom:u.origFrom,z=b?u.editTo:u.origTo;null==r&&(f<x?(r=u.editFrom,v=u.origFrom):f<z&&(r=u.editTo,v=u.origTo));z<=f?(l=u.editTo,q=u.origTo):x<=f&&(l=u.editFrom,q=u.origFrom)}f={edit:{before:l,after:r},orig:{before:q,after:v}};
h=U(h,b?f.edit:f.orig);f=U(m,b?f.orig:f.edit);k=(k-h.top)/(h.bot-h.top);(g=f.top-e+k*(f.bot-f.top))>c.top&&1>(d=c.top/e)?g=g*d+c.top*(1-d):(h=c.height-c.clientHeight-c.top)<e&&h<(k=m.getScrollInfo()).height-k.clientHeight-g&&1>(d=h/e)&&(g=g*d+(k.height-k.clientHeight-h)*(1-d))}c=(m.scrollTo(c.left,g),m.state.scrollSetAt=p,m.state.scrollSetBy=a,1)}return c}a.lockScroll&&null==a.needsScrollSync&&(a.needsScrollSync=b)}function U(a,b){var c=b.after;return null==c&&(c=a.lastLine()+1),{top:a.heightAtLine(b.before||
0,"local"),bot:a.heightAtLine(c,"local")}}function K(a,b,c){(a.lockScroll=b)&&0!=c&&D(a,DIFF_INSERT)&&B(a);(b?q.addClass:q.rmClass)(a.lockButton,"CodeMirror-merge-scrolllock-enabled")}function L(a,b,c){for(var e=0;e<b.length;++e){var f=b[e];if(f instanceof q.TextMarker)f.clear();else if(f.parent)for(var g=a,h=c,d=h.classLocation,k=0;k<d.length;k++)g.removeLineClass(f,d[k],h.chunk),g.removeLineClass(f,d[k],h.start),g.removeLineClass(f,d[k],h.end)}b.length=0}function V(a,b,c,e,f){var g=a.getViewport();
a.operation(function(){c.from==c.to||20<g.from-c.to||20<c.from-g.to?(L(a,c.marked,f),M(a,b,e,c.marked,g.from,g.to,f),c.from=g.from,c.to=g.to):(g.from<c.from&&(M(a,b,e,c.marked,g.from,c.from,f),c.from=g.from),g.to>c.to&&(M(a,b,e,c.marked,c.to,g.to,f),c.to=g.to))})}function N(a,b,c,e,f,g){var h=c.classLocation;b=a.getLineHandle(b);for(var d=0;d<h.length;d++)e&&a.addLineClass(b,h[d],c.chunk),f&&a.addLineClass(b,h[d],c.start),g&&a.addLineClass(b,h[d],c.end);return b}function M(a,b,c,e,f,g,h){function d(c,
b){for(var d=Math.max(f,c),k=Math.min(g,b),l=d;l<k;++l)e.push(N(a,l,h,!0,l==c,l==b-1));c==b&&d==b&&k==b&&(d?e.push(N(a,d-1,h,!1,!1,!0)):e.push(N(a,d,h,!1,!0,!1)))}for(var k=x(0,0),p=x(f,0),m=a.clipPos(x(g-1)),n=c==DIFF_DELETE?h.del:h.insert,l,r=0,q=!1,v=0;v<b.length;++v){var t,u,w,z=b[v],y=z[0],z=z[1];y==DIFF_EQUAL?(u=k.line+(W(b,v)?0:1),F(k,z),u<(t=k.line+(X(b,v)?1:0))&&(q&&(d(r,u),q=!1),r=t)):(q=!0,y==c&&(u=F(k,z,!0),t=k,z=0<((y=p).line-t.line||y.ch-t.ch)?y:t,y=u,w=0>((w=m).line-y.line||w.ch-y.ch)?
w:y,y=w,(l=z).line==y.line&&l.ch==y.ch||e.push(a.markText(z,w,{className:n})),k=u))}q&&d(r,k.line+1)}function B(a){if(a.showDifferences){a.svg&&(G(a.svg),b=a.gap.offsetWidth,Y(a.svg,"width",b,"height",a.gap.offsetHeight));a.copyButtons&&G(a.copyButtons);for(var b,c=a.edit.getViewport(),e=a.orig.getViewport(),f=a.mv.wrap.getBoundingClientRect().top,g=f-a.edit.getScrollerElement().getBoundingClientRect().top+a.edit.getScrollInfo().top,f=f-a.orig.getScrollerElement().getBoundingClientRect().top+a.orig.getScrollInfo().top,
h=0;h<a.chunks.length;h++){var d=a.chunks[h];if(d.editFrom<=c.to&&d.editTo>=c.from&&d.origFrom<=e.to&&d.origTo>=e.from){var k=n=m=p=n=p=k=m=void 0,p,m,n,k,l=a,r=f,q=g,v=b,t="left"==l.type,u=l.orig.heightAtLine(d.origFrom,"local",!0)-r;l.svg&&(m=u,k=l.edit.heightAtLine(d.editFrom,"local",!0)-q,t&&(p=m,m=k,k=p),r=l.orig.heightAtLine(d.origTo,"local",!0)-r,n=l.edit.heightAtLine(d.editTo,"local",!0)-q,t&&(p=r,r=n,n=p),t=" C "+v/2+" "+k+" "+v/2+" "+m+" "+(v+2)+" "+m,p=" C "+v/2+" "+r+" "+v/2+" "+n+" -1 "+
n,Y(l.svg.appendChild(document.createElementNS("http://www.w3.org/2000/svg","path")),"d","M -1 "+k+t+" L "+(v+2)+" "+r+p+" z","class",l.classes.connect));l.copyButtons&&(m=l.copyButtons.appendChild(w("div","left"==l.type?"⇝":"⇜","CodeMirror-merge-copy")),n=l.mv.options.allowEditingOriginals,m.title=l.edit.phrase(n?"Push to left":"Revert chunk"),m.chunk=d,m.style.top=(d.origTo>d.origFrom?u:l.edit.heightAtLine(d.editFrom,"local")-q)+"px",m.setAttribute("role","button"),m.setAttribute("tabindex","0"),
m.setAttribute("aria-label",m.title),n&&(k=l.edit.heightAtLine(d.editFrom,"local")-q,(t=l.copyButtons.appendChild(w("div","right"==l.type?"⇝":"⇜","CodeMirror-merge-copy-reverse"))).title="Push to right",t.chunk={editFrom:d.origFrom,editTo:d.origTo,origFrom:d.editFrom,origTo:d.editTo},t.style.top=k+"px","right"==l.type?t.style.left="2px":t.style.right="2px",t.setAttribute("role","button"),t.setAttribute("tabindex","0"),t.setAttribute("aria-label",t.title)))}}}}function Z(a,b){for(var c=0,e=0,f=0;f<
b.length;f++){var g=b[f];if(g.editTo>a&&g.editFrom<=a)return null;if(g.editFrom>a)break;c=g.editTo;e=g.origTo}return e+(a-c)}function O(a,b,c){var e=a.state.trackAlignable;a=a.firstLine();for(var f=0,g=[],h=0;;h++){for(var d=b[h],k=d?c?d.origFrom:d.editFrom:1E9;f<e.alignable.length;f+=2){var p=e.alignable[f]+1;if(!(p<=a)){if(!(p<=k))break;g.push(p)}}if(!d)break;g.push(a=c?d.origTo:d.editTo)}return g}function aa(a,b,c,e){var f=0,g=0,h=0,d=0;a:for(;;f++){var k=a[f],p=b[g];if(!k&&null==p)break;for(var m=
k?k[0]:1E9,n=null==p?1E9:p;h<c.length;){var l=c[h];if(l.origFrom<=n&&l.origTo>n){g++;f--;continue a}if(l.editTo>m){if(l.editFrom<=m)continue a;break}d+=l.origTo-l.origFrom-(l.editTo-l.editFrom);h++}m==n-d?(k[e]=n,g++):m<n-d?k[e]=m+d:((p=[n-d,null,null])[e]=n,a.splice(f,0,p),g++)}}function P(a,b){if(a.dealigned||b){if(!a.orig.curOp)return a.orig.operation(function(){P(a,b)});a.dealigned=!1;for(var c=a.mv.left==a?a.mv.right:a.mv.left,e=(c&&(C(c),c.dealigned=!1),function(a,c){var b=O(a.edit,a.chunks,
!1),e=[];if(c)for(var f=0,d=0;f<c.chunks.length;f++){for(var g=c.chunks[f].editTo;d<b.length&&b[d]<g;)d++;d!=b.length&&b[d]==g||b.splice(d++,0,g)}for(f=0;f<b.length;f++)e.push([b[f],null,null]);return aa(e,O(a.orig,a.chunks,!0),a.chunks,1),c&&aa(e,O(c.orig,c.chunks,!0),c.chunks,2),e}(a,c)),f=a.mv.aligners,g=0;g<f.length;g++)f[g].clear();f.length=0;var h=[a.edit,a.orig],d=[],k=[];c&&h.push(c.orig);for(g=0;g<h.length;g++)d.push(h[g].getScrollInfo().top),k.push(-h[g].getScrollerElement().getBoundingClientRect().top);
(k[0]!=k[1]||3==h.length&&k[1]!=k[2])&&ba(h,k,[0,0,0],f);for(c=0;c<e.length;c++)ba(h,k,e[c],f);for(g=0;g<h.length;g++)h[g].scrollTo(null,d[g])}}function ba(a,b,c,e){for(var f,g=-1E8,h=[],d=0;d<a.length;d++)null!=c[d]&&(f=a[d].heightAtLine(c[d],"local")-b[d],h[d]=f,g=Math.max(g,f));for(var k,p,m,n,l,d=0;d<a.length;d++)null==c[d]||1<(m=g-h[d])&&e.push((k=a[d],p=c[d],n=!(l=n=void 0),p>k.lastLine()&&(p--,n=!1),(l=document.createElement("div")).className="CodeMirror-merge-spacer",l.style.height=m+"px",
l.style.minWidth="1px",k.addLineWidget(p,l,{height:m,above:n,mergeSpacer:!0,handleMouseEvents:!0})))}function ca(a,b,c,e){var f,g,h,d;a.diffOutOfDate||(f=e.origTo>c.lastLine()?x(e.origFrom-1):x(e.origFrom,0),g=x(e.origTo,0),h=e.editTo>b.lastLine()?x(e.editFrom-1):x(e.editFrom,0),e=x(e.editTo,0),(d=a.mv.options.revertChunk)?d(a.mv,c,f,g,b,h,e):b.replaceRange(c.getRange(f,g),h,e))}function da(a){var b,c=a.lockButton=w("div",null,"CodeMirror-merge-scrolllock"),e=(c.setAttribute("role","button"),c.setAttribute("tabindex",
"0"),w("div",[c],"CodeMirror-merge-scrolllock-wrap")),c=(q.on(c,"click",function(){K(a,!a.lockScroll)}),q.on(c,"keyup",function(c){"Enter"!==c.key&&"Space"!==c.code||K(a,!a.lockScroll)}),[e]);return!1!==a.mv.options.revertButtons&&(a.copyButtons=w("div",null,"CodeMirror-merge-copybuttons-"+a.type),q.on(a.copyButtons,"click",b=function(c){c=c.target||c.srcElement;c.chunk&&("CodeMirror-merge-copy-reverse"==c.className?ca(a,a.orig,a.edit,c.chunk):ca(a,a.edit,a.orig,c.chunk))}),q.on(a.copyButtons,"keyup",
function(a){"Enter"!==a.key&&"Space"!==a.code||b(a)}),c.unshift(a.copyButtons)),"align"!=a.mv.options.connect&&((e=document.createElementNS&&document.createElementNS("http://www.w3.org/2000/svg","svg"))&&!e.createSVGRect&&(e=null),(a.svg=e)&&c.push(e)),a.gap=w("div",c,"CodeMirror-merge-gap")}function ea(a){return"string"==typeof a?a:a.getValue()}function S(a,b,c){a=(fa=fa||new diff_match_patch).diff_main(a,b);for(b=0;b<a.length;++b){var e=a[b];(c?/[^ \t]/.test(e[1]):e[1])?b&&a[b-1][0]==e[0]&&(a.splice(b--,
1),a[b][1]+=e[1]):a.splice(b--,1)}return a}function T(a){var b=[];if(!a.length)return b;for(var c=0,e=0,f=x(0,0),g=x(0,0),h=0;h<a.length;++h){var d,k,p,m,n=a[h],l=n[0];l==DIFF_EQUAL?(k=!W(a,h)||f.line<c||g.line<e?1:0,d=f.line+k,k=g.line+k,F(f,n[1],null,g),m=X(a,h)?1:0,p=f.line+m,m=g.line+m,d<p&&(h&&b.push({origFrom:e,origTo:k,editFrom:c,editTo:d}),c=p,e=m)):F(l==DIFF_INSERT?f:g,n[1])}return(c<=f.line||e<=g.line)&&b.push({origFrom:e,origTo:g.line+1,editFrom:c,editTo:f.line+1}),b}function X(a,b){if(b==
a.length-1)return 1;var c=a[b+1][1];return!(1==c.length&&b<a.length-2||10!=c.charCodeAt(0))&&(b==a.length-2||(1<(c=a[b+2][1]).length||b==a.length-3)&&10==c.charCodeAt(0))}function W(a,b){if(0==b)return 1;var c=a[b-1][1];return 10==c.charCodeAt(c.length-1)&&(1==b||10==(c=a[b-2][1]).charCodeAt(c.length-1))}function ga(a,b,c,e){for(var f=0;f<a.chunks.length;f++)for(var g=a.chunks[f],h=g.editFrom-b;h<g.editTo+b;h++){var d=h+c;0<=d&&d<e.length&&(e[d]=!1)}}function w(a,b,c,e){a=document.createElement(a);
if(c&&(a.className=c),e&&(a.style.cssText=e),"string"==typeof b)a.appendChild(document.createTextNode(b));else if(b)for(c=0;c<b.length;++c)a.appendChild(b[c]);return a}function G(a){for(var b=a.childNodes.length;0<b;--b)a.removeChild(a.firstChild)}function Y(a){for(var b=1;b<arguments.length;b+=2)a.setAttribute(arguments[b],arguments[b+1])}function Q(a,b){for(var c in b=b||{},a)a.hasOwnProperty(c)&&(b[c]=a[c]);return b}function F(a,b,c,e){a=c?x(a.line,a.ch):a;for(c=0;;){var f=b.indexOf("\n",c);if(-1==
f)break;++a.line;e&&++e.line;c=f+1}return a.ch=(c?0:a.ch)+(b.length-c),e&&(e.ch=(c?0:e.ch)+(b.length-c)),a}function R(a){this.cm=a;this.alignable=[];this.height=a.doc.height;var b=this;a.on("markerAdded",function(a,e){!e.collapsed||null!=(e=e.find(1))&&b.set(e.line,H)});a.on("markerCleared",function(a,e,f,g){null!=g&&e.collapsed&&b.check(g,H,b.hasMarker)});a.on("markerChanged",this.signal.bind(this));a.on("lineWidgetAdded",function(a,e,f){e.mergeSpacer||(e.above?b.set(f-1,A):b.set(f,ha))});a.on("lineWidgetCleared",
function(a,e,f){e.mergeSpacer||(e.above?b.check(f-1,A,b.hasWidgetBelow):b.check(f,ha,b.hasWidget))});a.on("lineWidgetChanged",this.signal.bind(this));a.on("change",function(a,e){var f=e.from.line,g=e.to.line-e.from.line,h=e.text.length-1,d=f+h;(g||h)&&b.map(f,g,h);b.check(d,H,b.hasMarker);(g||h)&&b.check(e.from.line,H,b.hasMarker)});a.on("viewportChange",function(){b.cm.doc.height!=b.height&&b.signal()})}function ia(a,b){var c=null,e=a.state.diffViews,f=a.getCursor().line;if(e)for(var g=0;g<e.length;g++){var h=
e[g],d=a==h.orig,h=(C(h),(0>b?function(a,c,b){for(var e=a.length-1;0<=e;e--){var d=a[e],d=(b?d.origTo:d.editTo)-1;if(d<c)return d}}:function(a,c,b){for(var e=0;e<a.length;e++){var d=a[e],d=b?d.origFrom:d.editFrom;if(c<d)return d}})(h.chunks,f,d));null==h||null!=c&&!(0>b?c<h:h<c)||(c=h)}if(null==c)return q.Pass;a.setCursor(c,0)}var x=q.Pos,I=!(E.prototype={constructor:E,init:function(a,b,c){this.edit=this.mv.edit;(this.edit.state.diffViews||(this.edit.state.diffViews=[])).push(this);this.orig=q(a,
Q({value:b,readOnly:!this.mv.options.allowEditingOriginals},Q(c)));"align"==this.mv.options.connect&&(this.edit.state.trackAlignable||(this.edit.state.trackAlignable=new R(this.edit)),this.orig.state.trackAlignable=new R(this.orig));this.lockButton.title=this.edit.phrase("Toggle locked scrolling");this.lockButton.setAttribute("aria-label",this.lockButton.title);this.orig.state.diffViews=[this];a=c.chunkClassLocation||"background";"[object Array]"!=Object.prototype.toString.call(a)&&(a=[a]);this.classes.classLocation=
a;this.diff=S(ea(b),ea(c.value),this.mv.options.ignoreWhitespace);this.chunks=T(this.diff);this.diffOutOfDate=this.dealigned=!1;this.needsScrollSync=null;this.showDifferences=!1!==c.showDifferences},registerEvents:function(a){var b;this.forceUpdate=function(a){function b(d){n=!(I=!0);"full"==d&&(a.svg&&G(a.svg),a.copyButtons&&G(a.copyButtons),L(a.edit,p.marked,a.classes),L(a.orig,m.marked,a.classes),p.from=p.to=m.from=m.to=0);C(a);a.showDifferences&&(V(a.edit,a.diff,p,DIFF_INSERT,a.classes),V(a.orig,
a.diff,m,DIFF_DELETE,a.classes));"align"==a.mv.options.connect&&P(a);B(a);null!=a.needsScrollSync&&D(a,a.needsScrollSync);I=!1}function f(b){I||(a.dealigned=!0,g(b))}function g(a){I||n||(clearTimeout(k),!0===a&&(n=!0),k=setTimeout(b,!0===a?20:250))}function h(b,d){a.diffOutOfDate||(a.diffOutOfDate=!0,p.from=p.to=m.from=m.to=0);f(d.text.length-1!=d.to.line-d.from.line)}function d(){a.diffOutOfDate=!0;a.dealigned=!0;b("full")}var k,p={from:0,to:0,marked:[]},m={from:0,to:0,marked:[]},n=!1;a.edit.on("change",
h);a.orig.on("change",h);a.edit.on("swapDoc",d);a.orig.on("swapDoc",d);"align"==a.mv.options.connect&&(q.on(a.edit.state.trackAlignable,"realign",f),q.on(a.orig.state.trackAlignable,"realign",f));return a.edit.on("viewportChange",function(){g(!1)}),a.orig.on("viewportChange",function(){g(!1)}),b(),b}(this);K(this,!0,!1);(b=this).edit.on("scroll",function(){D(b,!0)&&B(b)});b.orig.on("scroll",function(){D(b,!1)&&B(b);a&&D(a,!0)&&B(a)})},setShowDifferences:function(a){(a=!1!==a)!=this.showDifferences&&
(this.showDifferences=a,this.forceUpdate("full"))}}),fa,J=q.MergeView=function(a,b){function c(){n&&B(n);l&&B(l)}if(!(this instanceof J))return new J(a,b);var e,f,g=(this.options=b).origLeft,h=null==b.origRight?b.orig:b.origRight,d=null!=g,k=null!=h,p=1+(d?1:0)+(k?1:0),m=[],n=this.left=null,l=this.right=null,r=this,d=(d&&(n=this.left=new E(this,"left"),e=w("div",null,"CodeMirror-merge-pane CodeMirror-merge-left"),m.push(e),m.push(da(n))),w("div",null,"CodeMirror-merge-pane CodeMirror-merge-editor")),
A=(m.push(d),k&&(l=this.right=new E(this,"right"),m.push(da(l)),f=w("div",null,"CodeMirror-merge-pane CodeMirror-merge-right"),m.push(f)),(k?f:d).className+=" CodeMirror-merge-pane-rightmost",m.push(w("div",null,null,"height: 0; clear: both;")),this.wrap=a.appendChild(w("div",m,"CodeMirror-merge CodeMirror-merge-"+p+"pane"))),v=(this.edit=q(d,Q(b)),n&&n.init(e,g,b),l&&l.init(f,h,b),b.collapseIdentical&&this.editor().operation(function(){var a=b.collapseIdentical;"number"!=typeof a&&(a=2);for(var c=
[],d=r.editor(),e=d.firstLine(),f=e,g=d.lastLine();f<=g;f++)c.push(!0);r.left&&ga(r.left,a,e,c);r.right&&ga(r.right,a,e,c);for(f=0;f<c.length;f++)if(c[f]){for(var h,g=f+e,k=1;f<c.length-1&&c[f+1];f++,k++);a<k&&(h=[{line:g,cm:d}],r.left&&h.push({line:Z(g,r.left.chunks),cm:r.left.orig}),r.right&&h.push({line:Z(g,r.right.chunks),cm:r.right.orig}),h=function(a,b){function c(){for(var a=0;a<d.length;a++)d[a].clear()}for(var d=[],e=0;e<b.length;e++){var f=b[e],f=function(a,b,c){function d(){f.clear();a.removeLineClass(b,
"wrap","CodeMirror-merge-collapsed-line")}a.addLineClass(b,"wrap","CodeMirror-merge-collapsed-line");var e=document.createElement("span"),f=(e.className="CodeMirror-merge-collapsed-widget",e.title=a.phrase("Identical text collapsed. Click to expand."),a.markText(x(b,0),x(c-1),{inclusiveLeft:!0,inclusiveRight:!0,replacedWith:e,clearOnEnter:!0}));f.explicitlyCleared&&d();return q.on(e,"click",d),f.on("clear",d),q.on(e,"click",d),{mark:f,clear:d}}(f.cm,f.line,f.line+a);d.push(f);f.mark.on("clear",c)}return d[0].mark}(k,
h),r.options.onCollapse&&r.options.onCollapse(r,g,k,h))}}),"align"==b.connect&&(this.aligners=[],P(this.left||this.right,!0)),n&&n.registerEvents(l),l&&l.registerEvents(n),q.on(window,"resize",c),setInterval(function(){for(var a=A.parentNode;a&&a!=document.body;a=a.parentNode);a||(clearInterval(v),q.off(window,"resize",c))},5E3))};J.prototype={constructor:J,editor:function(){return this.edit},rightOriginal:function(){return this.right&&this.right.orig},leftOriginal:function(){return this.left&&this.left.orig},
setShowDifferences:function(a){this.right&&this.right.setShowDifferences(a);this.left&&this.left.setShowDifferences(a)},rightChunks:function(){if(this.right)return C(this.right),this.right.chunks},leftChunks:function(){if(this.left)return C(this.left),this.left.chunks}};var ha=1,A=2,H=4;R.prototype={signal:function(){q.signal(this,"realign");this.height=this.cm.doc.height},set:function(a,b){for(var c=-1;c<this.alignable.length;c+=2){var e=this.alignable[c]-a;if(0==e)return(this.alignable[c+1]&b)==
b?void 0:(this.alignable[c+1]|=b,void this.signal());if(0<e)break}this.signal();this.alignable.splice(c,0,a,b)},find:function(a){for(var b=0;b<this.alignable.length;b+=2)if(this.alignable[b]==a)return b;return-1},check:function(a,b,c){var e=this.find(a);-1!=e&&this.alignable[e+1]&b&&(c.call(this,a)||(this.signal(),(c=this.alignable[e+1]&~b)?this.alignable[e+1]=c:this.alignable.splice(e,2)))},hasMarker:function(a){a=this.cm.getLineHandle(a);if(a.markedSpans)for(var b=0;b<a.markedSpans.length;b++)if(a.markedSpans[b].marker.collapsed&&
null!=a.markedSpans[b].to)return!0;return!1},hasWidget:function(a){a=this.cm.getLineHandle(a);if(a.widgets)for(var b=0;b<a.widgets.length;b++)if(!a.widgets[b].above&&!a.widgets[b].mergeSpacer)return!0;return!1},hasWidgetBelow:function(a){if(a==this.cm.lastLine())return!1;a=this.cm.getLineHandle(a+1);if(a.widgets)for(var b=0;b<a.widgets.length;b++)if(a.widgets[b].above&&!a.widgets[b].mergeSpacer)return!0;return!1},map:function(a,b,c){for(var e=c-b,f=a+b,g=-1,h=-1,d=0;d<this.alignable.length;d+=2){var k=
this.alignable[d];k==a&&this.alignable[d+1]&A&&(g=d);k==f&&this.alignable[d+1]&A&&(h=d);k<=a||(k<f?this.alignable.splice(d--,2):this.alignable[d]+=e)}-1<g&&((b=this.alignable[g+1])==A?this.alignable.splice(g,2):this.alignable[g+1]=b&~A);-1<h&&c&&this.set(a+c,A)}};q.commands.goNextDiff=function(a){return ia(a,1)};q.commands.goPrevDiff=function(a){return ia(a,-1)}});