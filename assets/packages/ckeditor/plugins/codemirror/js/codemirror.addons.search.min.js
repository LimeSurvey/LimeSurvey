!function(b){"object"==typeof exports&&"object"==typeof module?b(require("../../lib/codemirror")):"function"==typeof define&&define.amd?define("addon/search/searchcursor",["../../lib/codemirror"],b):b(CodeMirror)}(function(b){function z(r,c){for(var a=null!=(a=r.flags)?a:(r.ignoreCase?"i":"")+(r.global?"g":"")+(r.multiline?"m":""),f=a,g=0;g<c.length;g++)-1==f.indexOf(c.charAt(g))&&(f+=c.charAt(g));return a==f?r:new RegExp(r.source,f)}function x(r,c,a){c=z(c,"g");var f=a.line,g=a.ch;for(a=r.lastLine();f<=
a;f++,g=0)if(c.lastIndex=g,g=r.getLine(f),g=c.exec(g))return{from:t(f,g.index),to:t(f,g.index+g[0].length),match:g}}function d(r,c,a){if(!/\\s|\\n|\n|\\W|\\D|\[\^/.test(c.source))return x(r,c,a);c=z(c,"gm");for(var f=1,g=a.line,y=r.lastLine();g<=y;){for(var h=0;h<f&&!(y<g);h++)var b=r.getLine(g++),e=null==e?b:e+"\n"+b;f*=2;c.lastIndex=a.ch;var n,d,k;if(h=c.exec(e))return k=e.slice(0,h.index).split("\n"),n=h[0].split("\n"),d=a.line+k.length-1,k=k[k.length-1].length,{from:t(d,k),to:t(d+n.length-1,1==
n.length?k+n[0].length:n[n.length-1].length),match:h}}}function p(r,c,a){for(var f,g=0;g<=r.length;){c.lastIndex=g;g=c.exec(r);if(!g)break;var b=g.index+g[0].length;if(b>r.length-a)break;(!f||b>f.index+f[0].length)&&(f=g);g=g.index+1}return f}function e(r,c,a){c=z(c,"g");var f=a.line;a=a.ch;for(var g=r.firstLine();g<=f;f--,a=-1){var b=r.getLine(f);if(b=p(b,c,0>a?0:b.length-a))return{from:t(f,b.index),to:t(f,b.index+b[0].length),match:b}}}function m(b,c,a){if(!/\\s|\\n|\n|\\W|\\D|\[\^/.test(c.source))return e(b,
c,a);c=z(c,"gm");var f=1,g=b.getLine(a.line).length-a.ch;a=a.line;for(var y=b.firstLine();y<=a;){for(var h=0;h<f&&y<=a;h++)var k=b.getLine(a--),d=null==d?k:k+"\n"+d;var f=2*f,n,u,l;if(h=p(d,c,g))return l=d.slice(0,h.index).split("\n"),n=h[0].split("\n"),u=a+l.length,l=l[l.length-1].length,{from:t(u,l),to:t(u+n.length-1,1==n.length?l+n[0].length:n[n.length-1].length),match:h}}}function k(b,c,a,f){if(b.length==c.length)return a;var g=0;for(c=a+Math.max(0,b.length-c.length);;){if(g==c)return g;var y=
g+c>>1,h=f(b.slice(0,y)).length;if(h==a)return y;a<h?c=y:g=1+y}}function v(b,c,a,f){if(!c.length)return null;f=f?u:q;c=f(c).split(/\r|\n\r?/);var g=a.line;a=a.ch;var y=b.lastLine()+1-c.length;a:for(;g<=y;g++,a=0){var h=b.getLine(g).slice(a),e=f(h);if(1==c.length){var d=e.indexOf(c[0]);if(-1!=d)return k(h,e,d,f),{from:t(g,k(h,e,d,f)+a),to:t(g,k(h,e,d+c[0].length,f)+a)}}else if(d=e.length-c[0].length,e.slice(d)==c[0]){for(var n=1;n<c.length-1;n++)if(f(b.getLine(g+n))!=c[n])continue a;var n=b.getLine(g+
c.length-1),l=f(n),p=c[c.length-1];if(l.slice(0,p.length)==p)return{from:t(g,k(h,e,d,f)+a),to:t(g+c.length-1,k(n,l,p.length,f))}}}}function w(b,c,a,f){if(!c.length)return null;f=f?u:q;c=f(c).split(/\r|\n\r?/);var g=a.line;a=a.ch;var e=b.firstLine()-1+c.length;a:for(;e<=g;g--,a=-1){var h=b.getLine(g),d=f(h=-1<a?h.slice(0,a):h);if(1==c.length){var l=d.lastIndexOf(c[0]);if(-1!=l)return{from:t(g,k(h,d,l,f)),to:t(g,k(h,d,l+c[0].length,f))}}else if(l=c[c.length-1],d.slice(0,l.length)==l){var n=1;for(a=
g-c.length+1;n<c.length-1;n++)if(f(b.getLine(a+n))!=c[n])continue a;a=b.getLine(g+1-c.length);n=f(a);if(n.slice(n.length-c[0].length)==c[0])return{from:t(g+1-c.length,k(a,n,a.length-c[0].length,f)),to:t(g,k(h,d,l.length,f))}}}}function l(b,c,a,f){var g;this.afterEmptyMatch=this.atOccurrence=!1;this.doc=b;a=a?b.clipPos(a):t(0,0);this.pos={from:a,to:a};"object"==typeof f?g=f.caseFold:(g=f,f=null);"string"==typeof c?(null==g&&(g=!1),this.matches=function(a,f){return(a?w:v)(b,c,f,g)}):(c=z(c,"gm"),f&&
!1===f.multiline?this.matches=function(a,f){return(a?e:x)(b,c,f)}:this.matches=function(a,f){return(a?m:d)(b,c,f)})}var u,q,t=b.Pos;q=String.prototype.normalize?(u=function(b){return b.normalize("NFD").toLowerCase()},function(b){return b.normalize("NFD")}):(u=function(b){return b.toLowerCase()},function(b){return b});l.prototype={findNext:function(){return this.find(!1)},findPrevious:function(){return this.find(!0)},find:function(d){var c=this.doc.clipPos(d?this.pos.from:this.pos.to);if(this.afterEmptyMatch&&
this.atOccurrence&&(c=t(c.line,c.ch),d?(c.ch--,0>c.ch&&(c.line--,c.ch=(this.doc.getLine(c.line)||"").length)):(c.ch++,c.ch>(this.doc.getLine(c.line)||"").length&&(c.ch=0,c.line++)),0!=b.cmpPos(c,this.doc.clipPos(c))))return this.atOccurrence=!1;c=this.matches(d,c);return this.afterEmptyMatch=c&&0==b.cmpPos(c.from,c.to),c?(this.pos=c,this.atOccurrence=!0,this.pos.match||!0):(c=t(d?this.doc.firstLine():this.doc.lastLine()+1,0),this.pos={from:c,to:c},this.atOccurrence=!1)},from:function(){if(this.atOccurrence)return this.pos.from},
to:function(){if(this.atOccurrence)return this.pos.to},replace:function(d,c){this.atOccurrence&&(d=b.splitLines(d),this.doc.replaceRange(d,this.pos.from,this.pos.to,c),this.pos.to=t(this.pos.from.line+d.length-1,d[d.length-1].length+(1==d.length?this.pos.from.ch:0)))}};b.defineExtension("getSearchCursor",function(b,c,a){return new l(this.doc,b,c,a)});b.defineDocExtension("getSearchCursor",function(b,c,a){return new l(this,b,c,a)});b.defineExtension("selectMatches",function(d,c){for(var a=[],f=this.getSearchCursor(d,
this.getCursor("from"),c);f.findNext()&&!(0<b.cmpPos(f.to(),this.getCursor("to")));)a.push({anchor:f.from(),head:f.to()});a.length&&this.setSelections(a,0)})});
(function(b){"object"==typeof exports&&"object"==typeof module?b(require("../../lib/codemirror")):"function"==typeof define&&define.amd?define("addon/dialog/dialog",["../../lib/codemirror"],b):b(CodeMirror)})(function(b){function z(d,p,e){d=d.getWrapperElement();var m=d.appendChild(document.createElement("div"));return m.className=e?"CodeMirror-dialog CodeMirror-dialog-bottom":"CodeMirror-dialog CodeMirror-dialog-top","string"==typeof p?m.innerHTML=p:m.appendChild(p),b.addClass(d,"dialog-opened"),
m}function x(b,p){b.state.currentNotificationClose&&b.state.currentNotificationClose();b.state.currentNotificationClose=p}b.defineExtension("openDialog",function(d,p,e){function m(d){"string"==typeof d?l.value=d:v||(v=!0,b.rmClass(k.parentNode,"dialog-opened"),k.parentNode.removeChild(k),w.focus(),e.onClose&&e.onClose(k))}e=e||{};x(this,null);var k=z(this,d,e.bottom),v=!1,w=this,l=k.getElementsByTagName("input")[0];return l?(l.focus(),e.value&&(l.value=e.value,!1!==e.selectValueOnOpen&&l.select()),
e.onInput&&b.on(l,"input",function(b){e.onInput(b,l.value,m)}),e.onKeyUp&&b.on(l,"keyup",function(b){e.onKeyUp(b,l.value,m)}),b.on(l,"keydown",function(d){e&&e.onKeyDown&&e.onKeyDown(d,l.value,m)||((27==d.keyCode||!1!==e.closeOnEnter&&13==d.keyCode)&&(l.blur(),b.e_stop(d),m()),13==d.keyCode&&p(l.value,d))}),!1!==e.closeOnBlur&&b.on(k,"focusout",function(b){null!==b.relatedTarget&&m()})):(d=k.getElementsByTagName("button")[0])&&(b.on(d,"click",function(){m();w.focus()}),!1!==e.closeOnBlur&&b.on(d,
"blur",m),d.focus()),m});b.defineExtension("openConfirm",function(d,p,e){function m(){v||(v=!0,b.rmClass(k.parentNode,"dialog-opened"),k.parentNode.removeChild(k),w.focus())}x(this,null);var k=z(this,d,e&&e.bottom);d=k.getElementsByTagName("button");var v=!1,w=this,l=1;d[0].focus();for(e=0;e<d.length;++e){var u=d[e];!function(d){b.on(u,"click",function(e){b.e_preventDefault(e);m();d&&d(w)})}(p[e]);b.on(u,"blur",function(){--l;setTimeout(function(){0>=l&&m()},200)});b.on(u,"focus",function(){++l})}});
b.defineExtension("openNotification",function(d,p){function e(){v||(v=!0,clearTimeout(m),b.rmClass(k.parentNode,"dialog-opened"),k.parentNode.removeChild(k))}x(this,e);var m,k=z(this,d,p&&p.bottom),v=!1;d=p&&void 0!==p.duration?p.duration:5E3;return b.on(k,"click",function(d){b.e_preventDefault(d);e()}),d&&(m=setTimeout(e,d)),e})});
(function(b){"object"==typeof exports&&"object"==typeof module?b(require("../../lib/codemirror"),require("./searchcursor"),require("../dialog/dialog")):"function"==typeof define&&define.amd?define("addon/search/search.js",["../../lib/codemirror","./searchcursor","../dialog/dialog"],b):b(CodeMirror)})(function(b){function z(){this.overlay=this.posFrom=this.posTo=this.lastQuery=this.query=null}function x(a){return a.state.search||(a.state.search=new z)}function d(a){return"string"==typeof a&&a==a.toLowerCase()}
function p(a,f,b){return a.getSearchCursor(f,b,{caseFold:d(f),multiline:!0})}function e(a,f,b,c,d){a.openDialog?a.openDialog(f,d,{value:c,selectValueOnOpen:!0,bottom:a.options.search.bottom}):d(prompt(b,c))}function m(a){return a.replace(/\\([nrt\\])/g,function(a,b){return"n"==b?"\n":"r"==b?"\r":"t"==b?"\t":"\\"==b?"\\":a})}function k(a){var b=a.match(/^\/(.*)\/([a-z]*)$/);if(b)try{a=new RegExp(b[1],-1==b[2].indexOf("i")?"":"i")}catch(c){}else a=m(a);return("string"==typeof a?""==a:a.test(""))?/x^/:
a}function v(a,b,c){var e;b.queryText=c;b.query=k(c);a.removeOverlay(b.overlay,d(b.query));b.overlay=(e=b.query,c=d(b.query),"string"==typeof e?e=new RegExp(e.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$\x26"),c?"gi":"g"):e.global||(e=new RegExp(e.source,e.ignoreCase?"gi":"g")),{token:function(a){e.lastIndex=a.pos;var b=e.exec(a.string);if(b&&b.index==a.pos)return a.pos+=b[0].length||1,"searching";b?a.pos=b.index:a.skipToEnd()}});a.addOverlay(b.overlay);a.showMatchesOnScrollbar&&(b.annotate&&
(b.annotate.clear(),b.annotate=null),b.annotate=a.showMatchesOnScrollbar(b.query,d(b.query)))}function w(a,c,d,k){var h=x(a);if(h.query)return l(a,c);var p,m,n,r,q=a.getSelection()||h.lastQuery;q instanceof RegExp&&"x^"==q.source&&(q=null);d&&a.openDialog?(p=null,m=function(c,f){b.e_stop(f);c&&(c!=h.queryText&&(v(a,h,c),h.posFrom=h.posTo=a.getCursor()),p&&(p.style.opacity=1),l(a,f.shiftKey,function(b,c){var f;3>c.line&&document.querySelector&&(f=a.display.wrapper.querySelector(".CodeMirror-dialog"))&&
f.getBoundingClientRect().bottom-4>a.cursorCoords(c,"window").top&&((p=f).style.opacity=.4)}))},d=t(a),n=q,r=function(c,f){var d=b.keyName(c),g=a.getOption("extraKeys"),g=g&&g[d]||b.keyMap[a.getOption("keyMap")][d];"findNext"==g||"findPrev"==g||"findPersistentNext"==g||"findPersistentPrev"==g?(b.e_stop(c),v(a,x(a),f),a.execCommand(g)):"find"!=g&&"findPersistent"!=g||(b.e_stop(c),m(f,c))},a.openDialog(d,m,{value:n,selectValueOnOpen:!0,closeOnEnter:!1,onClose:function(){u(a)},onKeyDown:r,bottom:a.options.search.bottom}),
k&&q&&(v(a,h,q),l(a,c))):e(a,t(a),"Search for:",q,function(b){b&&!h.query&&a.operation(function(){v(a,h,b);h.posFrom=h.posTo=a.getCursor();l(a,c)})})}function l(a,c,d){a.operation(function(){var e=x(a),h=p(a,e.query,c?e.posFrom:e.posTo);(h.find(c)||(h=p(a,e.query,c?b.Pos(a.lastLine()):b.Pos(a.firstLine(),0))).find(c))&&(a.setSelection(h.from(),h.to()),a.scrollIntoView({from:h.from(),to:h.to()},20),e.posFrom=h.from(),e.posTo=h.to(),d&&d(h.from(),h.to()))})}function u(a){a.operation(function(){var b=
x(a);(b.lastQuery=b.query)&&(b.query=b.queryText=null,a.removeOverlay(b.overlay),b.annotate&&(b.annotate.clear(),b.annotate=null))})}function q(a,b){var c,d=a?document.createElement(a):document.createDocumentFragment();for(c in b)d[c]=b[c];for(c=2;c<arguments.length;c++){var e=arguments[c];d.appendChild("string"==typeof e?document.createTextNode(e):e)}return d}function t(a){var b=q("label",{className:"CodeMirror-search-label"},a.phrase("Search:"),q("input",{type:"text",style:"width: 10em",className:"CodeMirror-search-field",
id:"CodeMirror-search-field"}));return b.setAttribute("for","CodeMirror-search-field"),q("",null,b," ",q("span",{style:"color: #666",className:"CodeMirror-search-hint"},a.phrase("(Use /re/ syntax for regexp search)")))}function r(a,b,c){a.operation(function(){for(var d,e=p(a,b);e.findNext();)"string"!=typeof b?(d=a.getRange(e.from(),e.to()).match(b),e.replace(c.replace(/\$(\d)/g,function(a,b){return d[b]}))):e.replace(c)})}function c(a,b){var c,d,h;a.getOption("readOnly")||(c=a.getSelection()||x(a).lastQuery,
h=q("",null,q("span",{className:"CodeMirror-search-label"},d=b?a.phrase("Replace all:"):a.phrase("Replace:")),(h=a,q("",null," ",q("input",{type:"text",style:"width: 10em",className:"CodeMirror-search-field"})," ",q("span",{style:"color: #666",className:"CodeMirror-search-hint"},h.phrase("(Use /re/ syntax for regexp search)"))))),e(a,h,d,c,function(c){c&&(c=k(c),e(a,q("",null,q("span",{className:"CodeMirror-search-label"},a.phrase("With:"))," ",q("input",{type:"text",style:"width: 10em",className:"CodeMirror-search-field"})),
a.phrase("Replace with:"),"",function(d){var e,g,h;d=m(d);b?r(a,c,d):(u(a),e=p(a,c,a.getCursor("from")),h=function(a){e.replace("string"==typeof c?d:d.replace(/\$(\d)/g,function(b,c){return a[c]}));g()},(g=function(){var b,f,l,k,m=e.from();!(b=e.findNext())&&(e=p(a,c),!(b=e.findNext())||m&&e.from().line==m.line&&e.from().ch==m.ch)||(a.setSelection(e.from(),e.to()),a.scrollIntoView({from:e.from(),to:e.to()}),k=q("",null,q("span",{className:"CodeMirror-search-label"},(k=m=a).phrase("Replace?"))," ",
q("button",{},k.phrase("Yes"))," ",q("button",{},k.phrase("No"))," ",q("button",{},k.phrase("All"))," ",q("button",{},k.phrase("Stop"))),f=a.phrase("Replace?"),l=[function(){h(b)},g,function(){r(a,c,d)}],m.openConfirm?m.openConfirm(k,l):confirm(f)&&l[0]())})())}))}))}b.defineOption("search",{bottom:!1});b.commands.find=function(a){u(a);w(a)};b.commands.findPersistent=function(a){u(a);w(a,!1,!0)};b.commands.findPersistentNext=function(a){w(a,!1,!0,!0)};b.commands.findPersistentPrev=function(a){w(a,
!0,!0,!0)};b.commands.findNext=w;b.commands.findPrev=function(a){w(a,!0)};b.commands.clearSearch=u;b.commands.replace=c;b.commands.replaceAll=function(a){c(a,!0)}});(function(b){"function"==typeof b.define&&b.define("addonSearch",["addon/search/search.js"],function(){})})(this);