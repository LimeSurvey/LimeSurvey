function updatetotals(e){console.ls.log(e);e=$(this).val();normalizeValue(e)?sumTable(this):$(this).val(e.substring(0,e.length-1))}function sumTable(element){var element=$(element).closest("table"),iGrandTotal=new Decimal(0);element.find("tr").each(function(){var sum=new Decimal(0);$(this).find("input:enabled:visible").each(function(){var value=normalizeValue($(this).val());sum=sum.plus(value)}),$(this).find("td.total input:disabled").val(formatValue(sum)).trigger("change").trigger("keyup").trigger("keydown"),iGrandTotal=iGrandTotal.plus(sum)});for(var iColumnNum=element.find("tbody tr:visible").first().find("input:enabled:visible").length,$iRow=element.find("tr"),i=1;i<=iColumnNum;i++){var sum=new Decimal(0);$iRow.each(function(){var item=$($(this).find("td").get(i-1)).find("input:enabled:visible"),item=normalizeValue($(item).val());sum=sum.plus(item)}),$($iRow.last().find("td.total").get(i-1)).find("input:disabled").val(formatValue(sum)).trigger("change").trigger("keyup").trigger("keydown")}$iRow.last().find("td.grand.total").find("input:disabled").val(formatValue(iGrandTotal)).trigger("change").trigger("keyup").trigger("keydown")}function formatValue(sValue){sValue=Number(sValue).toString();var sRadix=LSvar.sLEMradix;return sValue=sValue.replace(".",sRadix)}function normalizeValue(aValue){if(!new RegExp(/^-?([0-9]*)((,|\.){1}([0-9]*)){0,1}$/).test(aValue)&&bFixNumAuto)return 0;aValue=aValue||0;var outNumber=!1;try{outNumber=new Decimal(aValue)}catch(e){}if(0==outNumber){aValue=aValue.toString().replace(/,/g,".");try{outNumber=new Decimal(aValue)}catch(e){}}return outNumber}$(document).on("ready pjax:scriptcomplete",function(){$("div.array-multi-flexi-text table.show-totals input:enabled").keyup(updatetotals),$("div.array-multi-flexi-text table.show-totals input:enabled").each(updatetotals),$("div.array-multi-flexi-text table.show-totals tr.subquestion-list").on("relevance:on relevance:off",function(){sumTable(this)}),$("div.array-multi-flexi-text table.show-totals").closest("div.array-multi-flexi-text").on("relevance:on",function(){var firstRow=$(this).find("table.show-totals input:enabled:visible").first();firstRow.length&&sumTable(firstRow[0])})});
