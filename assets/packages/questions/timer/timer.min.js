(()=>{"use strict";function e(i){return e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e(i)}function i(e,i){for(var n=0;n<i.length;n++){var s=i[n];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,t(s.key),s)}}function t(i){var t=function(i,t){if("object"!=e(i)||!i)return i;var n=i[Symbol.toPrimitive];if(void 0!==n){var s=n.call(i,t||"default");if("object"!=e(s))return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(i)}
/**
 * @file Script for timer
 * @copyright LimeSurvey <http://www.limesurvey.org>
 * @license magnet:?xt=urn:btih:1f739d935676111cfff4b4693e3816e664797050&dn=gpl-3.0.txt GPL-v3-or-Later
 */(i,"string");return"symbol"==e(t)?t:t+""}var n=function(){return e=function e(i){var t=this;return function(e,i){if(!(e instanceof i))throw new TypeError("Cannot call a class as a function")}(this,e),this.option=this._parseOptions(i),this.timerWarning=null,this.timerWarning2=null,this.timerLogger=new ConsoleShim("TIMER#"+i.questionid,!window.debugState.frontend),this.intervalObject=null,this.warning=0,this.timersessionname="timer_question_"+this.option.questionid,this.surveyTimersItemName="limesurvey_timers_by_sid_"+this.option.surveyid,LSvar.bResetQuestionTimers&&this._unsetTimerInLocalStorage(),this.timeLeft=this._getTimerFromLocalStorage()||this.option.timer,this.disable_next=$("#disablenext-"+this.timersessionname).val(),this.disable_prev=$("#disableprev-"+this.timersessionname).val(),this.$timerDisplayElement=function(){return $("#LS_question"+t.option.questionid+"_Timer")},this.$timerExpiredElement=$("#question"+this.option.questionid+"_timer"),this.$warningTimeDisplayElement=$("#LS_question"+this.option.questionid+"_Warning"),this.$warningDisplayElement=$("#LS_question"+this.option.questionid+"_warning"),this.$warning2TimeDisplayElement=$("#LS_question"+this.option.questionid+"_Warning_2"),this.$warning2DisplayElement=$("#LS_question"+this.option.questionid+"_warning_2"),this.$countDownMessageElement=$("#countdown-message-"+this.timersessionname),this.redirectWarnTime=$("#message-delay-"+this.timersessionname).val(),this.$toBeDisabledElement=$("#"+this.option.disabledElement),this.timerLogger.log("Options set:",this.option),{startTimer:function(){return t.startTimer.apply(t)},finishTimer:function(){return t.finishTimer.apply(t)}}},(t=[{key:"_parseOptions",value:function(e){return{questionid:e.questionid||null,surveyid:e.surveyid||null,timer:e.timer||0,action:e.action||1,warning:e.warning||0,warning2:e.warning2||0,warninghide:e.warninghide||0,warning2hide:e.warning2hide||0,disabledElement:e.disabledElement||null}}},{key:"_parseTimeToObject",value:function(e,i){i=i||!1;var t=moment.duration(e,"seconds"),n=String(t.hours()),s=String(t.minutes()),r=String(t.seconds());return{hours:i?1==n.length?"0"+n:n:parseInt(n),minutes:i?1==s.length?"0"+s:s:parseInt(s),seconds:i?1==r.length?"0"+r:r:parseInt(sSecond)}}},{key:"_intervalStep",value:function(){var e=this._getTimerFromLocalStorage();e=parseInt(e)-1,this.timerLogger.log("Interval emitted | seconds left:",e),e<=0&&this.finishTimer(),this._checkForWarning(e),this._setTimerToLocalStorage(e),this._setTimer(e)}},{key:"_setInterval",value:function(){var e=this;this._existsDisplayElement()&&(this._setTimer(this.option.timer),this.intervalObject=setInterval((function(){return e._intervalStep.apply(e)}),1e3))}},{key:"_unsetInterval",value:function(){clearInterval(this.intervalObject),this.intervalObject=null}},{key:"_existsDisplayElement",value:function(){return!(!this.$timerDisplayElement().length>0&&(this._unsetInterval(),1))}},{key:"_setTimer",value:function(e){var i=this._parseTimeToObject(e,!0);this._existsDisplayElement()&&this.$timerDisplayElement().css({display:"flex"}).html(this.$countDownMessageElement.html()+"&nbsp;&nbsp;<div class='ls-timer-time'>"+i.hours+":"+i.minutes+":"+i.seconds+"</div>")}},{key:"_checkForWarning",value:function(e){e==this.option.warning&&this._showWarning(),e==this.option.warning2&&this._showWarning2()}},{key:"_showWarning",value:function(){var e=this;if(0!==this.option.warning){this.timerLogger.log("Warning called!");var i=this._parseTimeToObject(this.option.warning,!0);this.$warningTimeDisplayElement.html(i.hours+":"+i.minutes+":"+i.seconds),this.$warningDisplayElement.removeClass("hidden d-none").css({opacity:0}).animate({opacity:1},200),setTimeout((function(){e.timerLogger.log("Warning ended!"),e.$warningDisplayElement.animate({opacity:0},200,(function(){e.$warningDisplayElement.addClass("hidden d-none")}))}),1e3*this.option.warninghide)}}},{key:"_showWarning2",value:function(){var e=this;if(0!==this.option.warning2){this.timerLogger.log("Warning2 called!");var i=this._parseTimeToObject(this.option.warning,!0);this.$warning2TimeDisplayElement.html(i.hours+":"+i.minutes+":"+i.seconds),this.$warning2DisplayElement.removeClass("hidden d-none").css({opacity:0}).animate({opacity:1},200),setTimeout((function(){e.timerLogger.log("Warning2 ended!"),e.$warning2DisplayElement.animate({opacity:0},200,(function(){e.$warning2DisplayElement.addClass("hidden d-none")}))}),1e3*this.option.warning2hide)}}},{key:"_disableNavigation",value:function(){var e=this;this.timerLogger.log("Disabling navigation"),$(".ls-move-previous-btn").each((function(i,t){$(t).prop("disabled",1==e.disable_prev)})),$(".ls-move-next-btn,.ls-move-submit-btn").each((function(i,t){$(t).prop("disabled",1==e.disable_next)}))}},{key:"_enableNavigation",value:function(){$(".ls-move-previous-btn").each((function(){$(this).prop("disabled",!1)})),$(".ls-move-next-btn,.ls-move-submit-btn").each((function(){$(this).prop("disabled",!1)}))}},{key:"_getTimerFromLocalStorage",value:function(){if(!window.localStorage)return null;var e=window.localStorage.getItem("limesurvey_timers_"+this.timersessionname);return isNaN(parseInt(e))?0:e}},{key:"_setTimerToLocalStorage",value:function(e){window.localStorage&&window.localStorage.setItem("limesurvey_timers_"+this.timersessionname,e)}},{key:"_appendTimerToSurveyTimersList",value:function(){if(window.localStorage){var e=JSON.parse(window.localStorage.getItem(this.surveyTimersItemName)||"[]");e.includes(this.timersessionname)||e.push(this.timersessionname),window.localStorage.setItem(this.surveyTimersItemName,JSON.stringify(e))}}},{key:"_unsetTimerInLocalStorage",value:function(){window.localStorage&&window.localStorage.removeItem("limesurvey_timers_"+this.timersessionname)}},{key:"_warnBeforeRedirection",value:function(){this._disableInput(),setTimeout(this._redirectOut,this.redirectWarnTime)}},{key:"_disableInput",value:function(){this.$toBeDisabledElement.prop("readonly",!0),$("#question"+this.option.questionid).find(".answer-container").children("div").not(".timer_header").fadeOut()}},{key:"_showExpiredNotice",value:function(){this.$timerExpiredElement.removeClass("hidden d-none")}},{key:"_redirectOut",value:function(){$("#ls-button-submit").trigger("click")}},{key:"_bindUnsetToSubmit",value:function(){var e=this;$("#limesurvey").on("submit",(function(){e._unsetTimerInLocalStorage()}))}},{key:"finishTimer",value:function(){switch(this.timerLogger.log("Timer has ended or was ended"),this._unsetInterval(),this._enableNavigation(),this._bindUnsetToSubmit(),this._disableInput(),this.option.action){case 3:this._showExpiredNotice();break;case 2:this._redirectOut();break;default:this._showExpiredNotice(),this._warnBeforeRedirection()}}},{key:"startTimer",value:function(){0!=this.timeLeft?(this._appendTimerToSurveyTimersList(),this._setTimerToLocalStorage(this.timeLeft),this._disableNavigation(),this._setInterval()):this.finishTimer()}}])&&i(e.prototype,t),n&&i(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t,n}();
/**
 * @file Script for timer
 * @copyright LimeSurvey <http://www.limesurvey.org>
 * @license magnet:?xt=urn:btih:1f739d935676111cfff4b4693e3816e664797050&dn=gpl-3.0.txt GPL-v3-or-Later
 */
window.countdown=function(e,i,t,s,r,o,a,l,m){window.timerObjectSpace=window.timerObjectSpace||{},window.timerObjectSpace[e]||(window.timerObjectSpace[e]=new n({questionid:e,surveyid:i,timer:t,action:s,warning:r,warning2:o,warninghide:a,warning2hide:l,disabledElement:m}),window.timerObjectSpace[e].startTimer())}})();